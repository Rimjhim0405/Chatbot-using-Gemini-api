<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Velora Chatbot</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> 
    <style>
        /* Your existing CSS styles */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* ... (rest of your CSS) ... */

        /* Optional: Basic styling for code blocks and lists */
        .bot-message pre {
            background-color: #e0e0e0;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto; /* For long lines of code */
        }
        .dark-mode .bot-message pre {
            background-color: #555555;
        }

        .bot-message code {
            font-family: 'Courier New', Courier, monospace;
            background-color: #e0e0e0; /* light background for inline code */
            padding: 2px 4px;
            border-radius: 3px;
        }
        .dark-mode .bot-message code {
            background-color: #555555;
        }

        .bot-message ul, .bot-message ol {
            margin-left: 20px;
            padding-left: 0;
        }

        .bot-message p {
            margin-bottom: 8px; /* Add some spacing between paragraphs */
        }
    </style>
</head>
<body>
    <script>
        // ... (your existing JavaScript code) ...

        async function send() {
            let msg = document.getElementById('msg').value;
            if (!msg) return;

            // Show the user message immediately
            document.getElementById("chat").insertAdjacentHTML('beforeend', `<div class="user-message"><b>You:</b> ${msg}</div>`);
            document.getElementById("msg").value = "";

            // Show the bot's placeholder response
            let chatDiv = document.getElementById("chat");
            let botPara = document.createElement('div');
            botPara.classList.add('bot-message');
            botPara.innerHTML = `<b>Velora:</b> <span class="typing-indicator">Typing...</span>`;
            chatDiv.appendChild(botPara);
            chatDiv.scrollTop = chatDiv.scrollHeight;

            // Fetch the response from the backend
            let res = await fetch("/chat", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ message: msg })
            });

            const data = await res.json();
            let response = data.response;

            // --- IMPORTANT CHANGE HERE ---
            // Use marked.js to convert Markdown to HTML
            // Note: marked.parse() is asynchronous, so use await
            let formattedResponse = await marked.parse(response);

            // Start typing the bot response
            let span = botPara.querySelector('.typing-indicator');
            let i = 0;
            let speed = 20; // Typing speed (ms per character)

            // To make typing animation work with HTML, you'll need a different approach.
            // For now, let's just display the full formatted response directly
            // to ensure formatting is working.
            // If you want a typing effect with formatted text, it's more complex (see note below).
            
            clearInterval(typer); // Clear any previous typer if it exists (good practice)
            span.innerHTML = formattedResponse; // Display the full formatted HTML response
            chatDiv.scrollTop = chatDiv.scrollHeight;
            
            /*
            // If you *really* want a typing effect for HTML, you'd typically:
            // 1. Get the plain text version of the response for the typing effect.
            // 2. Or, more robustly, render chunks of HTML, which is very complex.
            // For now, I've simplified it to show the full formatted response.
            // If you want a typing effect, you might need to type the plain text and
            // then replace it with the formatted HTML at the end, or look into
            // libraries designed for typing formatted content.
            
            // Example of typing plain text then replacing with formatted (less ideal)
            let plainResponseForTyping = response; // Use the raw markdown for typing
            let typer = setInterval(() => {
                if (i < plainResponseForTyping.length) {
                    span.textContent = plainResponseForTyping.substring(0, i++) + " |";
                } else {
                    clearInterval(typer);
                    span.innerHTML = formattedResponse; // Replace with formatted HTML
                }
                chatDiv.scrollTop = chatDiv.Div.scrollHeight;
            }, speed);
            */
        }
    </script>
</body>
</html>
